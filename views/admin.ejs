<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProxyFlow Admin | Residential 0 Fraud</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: #e0e0e0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        .stats { display: flex; gap: 20px; margin-bottom: 30px; }
        .card { background: #181818; padding: 20px; border-radius: 12px; flex: 1; border: 1px solid #222; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        h1, h2 { color: #2ecc71; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #181818; border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid #222; text-align: left; }
        th { background: #2ecc71; color: #000; text-transform: uppercase; font-size: 0.85rem; }
        textarea { width: 100%; height: 60px; background: #121212; color: #2ecc71; border: 1px solid #333; padding: 8px; border-radius: 5px; margin-bottom: 5px; }
        button { border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; border-radius: 6px; transition: 0.3s; }
        .btn-deliver { background: #2ecc71; color: #000; width: 100%; margin-bottom: 5px; }
        .btn-deliver:hover { background: #27ae60; }
        .btn-refuse { background: #e74c3c; color: white; width: 100%; font-size: 0.7rem; }
        .btn-refuse:hover { background: #c0392b; }
        .btn-free { background: #f1c40f; margin-top: 10px; color: #000; }
        .status-manual { color: #e74c3c; font-weight: bold; font-size: 0.8rem; }
        .status-balance { color: #3498db; font-weight: bold; font-size: 0.8rem; }
        .email-cell { color: #3498db; font-weight: bold; }
        .action-cell { min-width: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ProxyFlow Admin Panel</h1>

        <div class="stats">
            <div class="card"><h3>Clients</h3><p style="font-size: 1.5rem;"><%= stats.u %></p></div>
            <div class="card"><h3>Delivered</h3><p style="font-size: 1.5rem;"><%= stats.s %></p></div>
            <div class="card"><h3>Total Earnings</h3><p style="font-size: 1.5rem; color: #2ecc71;">$<%= stats.g %></p></div>
        </div>

        <div class="card" style="margin-bottom: 30px; border-left: 5px solid #f1c40f;">
            <h2>üéÅ Manage Free Proxies</h2>
            <form action="/admin/update-free" method="POST">
                <textarea name="freeContent" placeholder="Paste proxies here (IP:PORT:USER:PASS)"></textarea>
                <button type="submit" class="btn-free">Update Free List</button>
            </form>
        </div>

        <h2>‚è≥ Pending Residential Orders</h2>
        <table>
            <thead>
                <tr>
                    <th>Customer Email</th>
                    <th>Product Details</th>
                    <th>Price</th>
                    <th>Method</th>
                    <th>Action (Delivery or Refuse)</th>
                </tr>
            </thead>
            <tbody>
                <% pending.forEach(order => { %>
                    <tr>
                        <td class="email-cell"><%= order.customerEmail %></td>
                        <td style="color:#f1c40f;"><%= order.provider %></td>
                        <td>$<%= order.price.toFixed(2) %></td>
                        <td class="<%= order.status.includes('Manual') ? 'status-manual' : 'status-balance' %>">
                            <%= order.status %>
                        </td>
                        <td class="action-cell">
                            <form action="/admin/deliver" method="POST" style="margin-bottom: 10px;">
                                <input type="hidden" name="orderId" value="<%= order.orderId %>">
                                <textarea name="proxyData" placeholder="Enter Proxy Credentials..." required></textarea>
                                <button type="submit" class="btn-deliver">DELIVER NOW ‚úÖ</button>
                            </form>

                            <form action="/admin/refuse" method="POST" onsubmit="return confirm('Refuse this order? This will remove it from the list.');">
                                <input type="hidden" name="orderId" value="<%= order.orderId %>">
                                <button type="submit" class="btn-refuse">REFUSE & DELETE ‚ùå</button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>

        <h2 style="margin-top: 50px;">üë§ Registered Users</h2>
        <table>
            <thead>
                <tr>
                    <th>User Email</th>
                    <th>Current Balance</th>
                    <th>Add Funds</th>
                </tr>
            </thead>
            <tbody>
                <% users.forEach(u => { %>
                    <tr>
                        <td><%= u.email %></td>
                        <td style="color: #2ecc71;">$<%= u.balance.toFixed(2) %></td>
                        <td>
                            <form action="/admin/add-balance" method="POST" style="display:flex; gap:10px;">
                                <input type="hidden" name="psid" value="<%= u.psid %>">
                                <input type="number" name="amount" step="0.01" min="5" placeholder="Min $5.00" style="width:100px; padding: 5px; border-radius: 4px; border: 1px solid #333; background: #121212; color: white;">
                                <button type="submit" style="background:#2ecc71; color:#000;">Add Cash</button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</body>
</html>
