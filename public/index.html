<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NRPROXY ‚Äî Admin Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --p: #6366f1; --p2: #8b5cf6;
      --bg: #0f1117; --bg2: #1a1d2e;
      --card: #1e2235; --card2: #252840;
      --border: rgba(255,255,255,0.07);
      --text: #f1f5f9; --muted: #64748b;
      --success: #10b981; --danger: #ef4444;
      --warning: #f59e0b; --info: #3b82f6;
      --radius: 14px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'DM Sans',sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; overflow-x:hidden;
    }
    h1,h2,h3,h4 { font-family:'Syne',sans-serif; }

    /* ‚îÄ‚îÄ Grid background ‚îÄ‚îÄ */
    body::before {
      content:''; position:fixed; inset:0; z-index:0;
      background-image:
        linear-gradient(rgba(99,102,241,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,0.025) 1px, transparent 1px);
      background-size:48px 48px; pointer-events:none;
    }

    /* ‚îÄ‚îÄ Login Gate ‚îÄ‚îÄ */
    #login-gate {
      position:fixed; inset:0; z-index:1000;
      background:var(--bg);
      display:flex; align-items:center; justify-content:center;
    }
    .login-box {
      width:100%; max-width:400px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:20px;
      padding:40px 36px;
      position:relative;
      box-shadow:0 24px 64px rgba(0,0,0,0.6);
      animation:fadeUp .5s ease both;
    }
    .login-logo {
      text-align:center; margin-bottom:28px;
    }
    .login-logo .brand {
      font-family:'Syne',sans-serif; font-size:1.5rem; font-weight:800;
      background:linear-gradient(135deg,#818cf8,#a78bfa);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .login-logo .sub {
      font-size:.75rem; color:var(--muted);
      text-transform:uppercase; letter-spacing:.1em;
      margin-top:4px;
    }
    .field { margin-bottom:16px; }
    .field label { display:block; font-size:.78rem; font-weight:600; color:var(--muted); margin-bottom:6px; text-transform:uppercase; letter-spacing:.05em; }
    .field input {
      width:100%; padding:11px 14px; border-radius:10px;
      background:var(--bg2); border:1px solid var(--border);
      color:var(--text); font-size:.9rem; font-family:'DM Sans',sans-serif;
      transition:border-color .2s;
      outline:none;
    }
    .field input:focus { border-color:var(--p); }
    .btn-login {
      width:100%; padding:13px; border-radius:10px;
      background:linear-gradient(135deg,var(--p),var(--p2));
      color:white; font-weight:700; font-size:.95rem;
      border:none; cursor:pointer; margin-top:8px;
      transition:all .2s; font-family:'DM Sans',sans-serif;
    }
    .btn-login:hover { opacity:.9; transform:translateY(-1px); box-shadow:0 8px 24px rgba(99,102,241,.4); }
    .btn-login:disabled { opacity:.6; cursor:not-allowed; transform:none; }
    .login-err {
      margin-top:14px; padding:10px 14px; border-radius:9px;
      background:rgba(239,68,68,.1); border:1px solid rgba(239,68,68,.2);
      color:#fca5a5; font-size:.82rem; display:none;
    }

    /* ‚îÄ‚îÄ Main App ‚îÄ‚îÄ */
    #app { display:none; position:relative; z-index:1; }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .sidebar {
      position:fixed; top:0; left:0; bottom:0; width:240px;
      background:var(--bg2); border-right:1px solid var(--border);
      display:flex; flex-direction:column; z-index:200;
      transition:transform .3s ease;
    }
    .sidebar-logo { padding:24px 20px 20px; border-bottom:1px solid var(--border); }
    .sidebar-logo .brand {
      font-family:'Syne',sans-serif; font-size:1.15rem; font-weight:800;
      background:linear-gradient(135deg,#818cf8,#a78bfa);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .badge-admin {
      display:inline-block; margin-top:4px;
      background:rgba(99,102,241,.2); color:#a78bfa;
      font-size:.68rem; font-weight:700; padding:2px 8px;
      border-radius:20px; letter-spacing:.06em;
    }
    .nav-menu { flex:1; padding:14px 10px; overflow-y:auto; }
    .nav-section-label {
      font-size:.63rem; font-weight:700; color:var(--muted);
      text-transform:uppercase; letter-spacing:.1em;
      padding:8px 10px 4px; margin-top:8px;
    }
    .nav-item {
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:9px;
      cursor:pointer; font-size:.86rem; font-weight:500;
      color:var(--muted); transition:all .18s;
      border:none; background:none; width:100%;
      text-align:left; margin-bottom:2px; text-decoration:none;
    }
    .nav-item i { width:17px; text-align:center; font-size:.82rem; }
    .nav-item:hover { background:rgba(255,255,255,.05); color:var(--text); }
    .nav-item.active { background:rgba(99,102,241,.15); color:#818cf8; font-weight:600; }
    .nav-badge {
      margin-left:auto; background:var(--warning);
      color:#000; border-radius:20px; font-size:.65rem;
      font-weight:800; padding:1px 7px; min-width:20px; text-align:center;
    }
    .nav-badge.hidden { display:none; }
    .sidebar-footer { padding:14px 10px; border-top:1px solid var(--border); }
    .admin-info {
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:10px;
      background:rgba(255,255,255,.04); margin-bottom:8px;
    }
    .admin-avatar {
      width:32px; height:32px; border-radius:50%;
      background:linear-gradient(135deg,var(--p),var(--p2));
      display:flex; align-items:center; justify-content:center;
      font-weight:800; font-size:.82rem; flex-shrink:0;
    }
    .admin-email { font-size:.75rem; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .logout-btn {
      width:100%; padding:9px; border-radius:9px;
      background:rgba(239,68,68,.1); color:#ef4444;
      border:1px solid rgba(239,68,68,.2);
      font-size:.83rem; font-weight:600; cursor:pointer;
      transition:all .18s; display:flex; align-items:center; justify-content:center; gap:6px;
      font-family:'DM Sans',sans-serif;
    }
    .logout-btn:hover { background:rgba(239,68,68,.2); }

    /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
    .main { margin-left:240px; min-height:100vh; display:flex; flex-direction:column; }
    .topbar {
      padding:14px 28px; background:var(--bg2);
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
      position:sticky; top:0; z-index:100;
    }
    .topbar-title { font-family:'Syne',sans-serif; font-size:1.05rem; font-weight:700; }
    .topbar-right { display:flex; align-items:center; gap:10px; }
    .refresh-btn {
      padding:7px 14px; border-radius:8px;
      background:rgba(99,102,241,.15); color:#818cf8;
      border:1px solid rgba(99,102,241,.25);
      font-size:.8rem; font-weight:600; cursor:pointer;
      display:flex; align-items:center; gap:6px; transition:all .18s;
      font-family:'DM Sans',sans-serif;
    }
    .refresh-btn:hover { background:rgba(99,102,241,.25); }
    .hamburger {
      display:none; background:none; border:none;
      color:var(--text); font-size:1.3rem; cursor:pointer; padding:6px;
    }
    .content { padding:24px 28px; flex:1; }

    /* ‚îÄ‚îÄ Stats ‚îÄ‚îÄ */
    .stats-grid {
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:14px; margin-bottom:24px;
    }
    .stat-card {
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius); padding:18px 20px;
      display:flex; align-items:center; gap:14px;
      transition:transform .2s;
    }
    .stat-card:hover { transform:translateY(-2px); }
    .stat-icon {
      width:44px; height:44px; border-radius:11px;
      display:flex; align-items:center; justify-content:center;
      font-size:1rem; flex-shrink:0;
    }
    .si-purple { background:rgba(99,102,241,.15); color:#818cf8; }
    .si-green  { background:rgba(16,185,129,.15); color:#10b981; }
    .si-blue   { background:rgba(59,130,246,.15); color:#3b82f6; }
    .si-amber  { background:rgba(245,158,11,.15); color:#f59e0b; }
    .si-red    { background:rgba(239,68,68,.15); color:#ef4444; }
    .stat-label { font-size:.72rem; color:var(--muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:.06em; }
    .stat-value { font-family:'Syne',sans-serif; font-size:1.65rem; font-weight:800; line-height:1; }

    /* ‚îÄ‚îÄ Quick links ‚îÄ‚îÄ */
    .quick-grid {
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:12px; margin-bottom:24px;
    }
    .quick-card {
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius); padding:18px;
      display:flex; flex-direction:column; align-items:center; gap:10px;
      text-decoration:none; color:var(--text);
      transition:all .2s; cursor:pointer;
      text-align:center;
    }
    .quick-card:hover { border-color:rgba(99,102,241,.4); background:rgba(99,102,241,.07); transform:translateY(-2px); }
    .quick-icon {
      width:46px; height:46px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-size:1.1rem;
    }
    .quick-label { font-size:.82rem; font-weight:600; }
    .quick-sub { font-size:.72rem; color:var(--muted); }

    /* ‚îÄ‚îÄ Grid 2-col ‚îÄ‚îÄ */
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-bottom:24px; }
    .grid3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:18px; margin-bottom:24px; }

    /* ‚îÄ‚îÄ Panel ‚îÄ‚îÄ */
    .panel {
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius); overflow:hidden;
    }
    .panel-head {
      padding:16px 20px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
    }
    .panel-title { font-family:'Syne',sans-serif; font-size:.95rem; font-weight:700; }
    .panel-body { padding:20px; }
    .view-all {
      font-size:.78rem; color:#818cf8; font-weight:600;
      text-decoration:none; display:flex; align-items:center; gap:4px;
    }
    .view-all:hover { color:#a78bfa; }

    /* ‚îÄ‚îÄ Table ‚îÄ‚îÄ */
    .tbl { width:100%; border-collapse:collapse; font-size:.83rem; }
    .tbl thead th { padding:9px 12px; text-align:left; color:var(--muted); font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:.06em; border-bottom:1px solid var(--border); }
    .tbl tbody td { padding:11px 12px; border-bottom:1px solid var(--border); }
    .tbl tbody tr:last-child td { border-bottom:none; }
    .tbl tbody tr:hover td { background:rgba(255,255,255,.02); }

    /* ‚îÄ‚îÄ Badges ‚îÄ‚îÄ */
    .badge {
      display:inline-block; padding:3px 10px; border-radius:20px;
      font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:.04em;
    }
    .badge-pending  { background:rgba(245,158,11,.15); color:#f59e0b; }
    .badge-approved { background:rgba(16,185,129,.15); color:#10b981; }
    .badge-rejected { background:rgba(239,68,68,.15); color:#ef4444; }
    .badge-delivered{ background:rgba(59,130,246,.15); color:#3b82f6; }
    .badge-admin    { background:rgba(139,92,246,.15); color:#a78bfa; }
    .badge-user     { background:rgba(100,116,139,.15); color:#94a3b8; }

    /* ‚îÄ‚îÄ Avatar ‚îÄ‚îÄ */
    .user-avatar {
      width:30px; height:30px; border-radius:50%;
      display:inline-flex; align-items:center; justify-content:center;
      font-size:.75rem; font-weight:800;
      background:linear-gradient(135deg,var(--p),var(--p2));
      vertical-align:middle; margin-right:8px; flex-shrink:0;
    }

    /* ‚îÄ‚îÄ Activity feed ‚îÄ‚îÄ */
    .activity-item {
      display:flex; align-items:flex-start; gap:12px;
      padding:12px 0; border-bottom:1px solid var(--border);
    }
    .activity-item:last-child { border-bottom:none; padding-bottom:0; }
    .act-icon {
      width:34px; height:34px; border-radius:9px; flex-shrink:0;
      display:flex; align-items:center; justify-content:center; font-size:.85rem;
    }
    .act-text { flex:1; }
    .act-title { font-size:.83rem; font-weight:600; margin-bottom:2px; }
    .act-sub { font-size:.75rem; color:var(--muted); }
    .act-time { font-size:.7rem; color:var(--muted); white-space:nowrap; }

    /* ‚îÄ‚îÄ Revenue donut placeholder ‚îÄ‚îÄ */
    .revenue-ring {
      width:130px; height:130px; position:relative; margin:0 auto 20px;
    }
    .revenue-ring svg { transform:rotate(-90deg); }
    .ring-center {
      position:absolute; inset:0; display:flex;
      flex-direction:column; align-items:center; justify-content:center;
    }
    .ring-val { font-family:'Syne',sans-serif; font-size:1.2rem; font-weight:800; }
    .ring-label { font-size:.68rem; color:var(--muted); }
    .legend-item { display:flex; align-items:center; gap:8px; font-size:.8rem; margin-bottom:6px; }
    .legend-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }

    /* ‚îÄ‚îÄ System status ‚îÄ‚îÄ */
    .sys-row {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 0; border-bottom:1px solid var(--border); font-size:.83rem;
    }
    .sys-row:last-child { border-bottom:none; }
    .sys-label { color:var(--muted); }
    .sys-val { font-weight:600; display:flex; align-items:center; gap:6px; }
    .dot-live { width:7px; height:7px; border-radius:50%; background:var(--success); animation:pulse-g 2s infinite; }
    .dot-warn { width:7px; height:7px; border-radius:50%; background:var(--warning); }
    @keyframes pulse-g { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.8)} }

    /* ‚îÄ‚îÄ Progress bar ‚îÄ‚îÄ */
    .progress-bar { height:5px; border-radius:100px; background:rgba(255,255,255,.07); overflow:hidden; margin-top:4px; }
    .progress-fill { height:100%; border-radius:100px; background:linear-gradient(90deg,var(--p),var(--p2)); transition:width 1s ease; }

    /* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
    @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .fadeup { animation:fadeUp .5s ease both; }
    .fadeup-1 { animation-delay:.05s; }
    .fadeup-2 { animation-delay:.1s; }
    .fadeup-3 { animation-delay:.15s; }

    /* ‚îÄ‚îÄ Overlay ‚îÄ‚îÄ */
    .overlay {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,.5);
      z-index:150; backdrop-filter:blur(2px);
    }
    .overlay.open { display:block; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media(max-width:1100px) {
      .stats-grid { grid-template-columns:repeat(2,1fr); }
      .quick-grid { grid-template-columns:repeat(2,1fr); }
      .grid2 { grid-template-columns:1fr; }
      .grid3 { grid-template-columns:1fr; }
    }
    @media(max-width:768px) {
      .sidebar { transform:translateX(-100%); }
      .sidebar.open { transform:translateX(0); }
      .main { margin-left:0; }
      .hamburger { display:block; }
      .content { padding:16px; }
      .stats-grid { grid-template-columns:1fr 1fr; }
    }
    @media(max-width:480px) {
      .stats-grid { grid-template-columns:1fr; }
      .quick-grid { grid-template-columns:1fr 1fr; }
    }

    /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
    .empty { text-align:center; padding:32px; color:var(--muted); font-size:.85rem; }
    .empty i { font-size:2rem; margin-bottom:8px; display:block; opacity:.4; }

    /* ‚îÄ‚îÄ Topbar clock ‚îÄ‚îÄ */
    .topbar-clock { font-size:.75rem; color:var(--muted); font-family:'DM Sans',sans-serif; }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN GATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="login-gate">
  <div class="login-box">
    <div class="login-logo">
      <div class="brand">üåê NRPROXY</div>
      <div class="sub">Admin Portal</div>
    </div>
    <div class="field">
      <label>Email</label>
      <input type="email" id="l-email" placeholder="admin@nrproxy.com" autocomplete="username">
    </div>
    <div class="field">
      <label>Password</label>
      <input type="password" id="l-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <button class="btn-login" id="l-btn" onclick="doLogin()">
      <i class="fas fa-sign-in-alt"></i> Sign In
    </button>
    <div class="login-err" id="l-err"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app">

  <!-- Sidebar overlay (mobile) -->
  <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="brand">üåê NRPROXY</div>
      <div class="badge-admin">ADMIN PORTAL</div>
    </div>
    <nav class="nav-menu">
      <div class="nav-section-label">Overview</div>
      <button class="nav-item active" onclick="showTab('dashboard')">
        <i class="fas fa-home"></i> Dashboard
      </button>

      <div class="nav-section-label">Management</div>
      <button class="nav-item" onclick="showTab('users')">
        <i class="fas fa-users"></i> Users
        <span class="nav-badge hidden" id="badge-users">0</span>
      </button>
      <button class="nav-item" onclick="showTab('recharges')">
        <i class="fas fa-wallet"></i> Recharges
        <span class="nav-badge hidden" id="badge-recharges">0</span>
      </button>
      <button class="nav-item" onclick="showTab('orders')">
        <i class="fas fa-box"></i> Orders
        <span class="nav-badge hidden" id="badge-orders">0</span>
      </button>

      <div class="nav-section-label">Links</div>
      <a class="nav-item" href="admin.html">
        <i class="fas fa-sliders-h"></i> Full Admin Panel
      </a>
      <a class="nav-item" href="dashboard.html">
        <i class="fas fa-user"></i> User Dashboard
      </a>
      <a class="nav-item" href="/health" target="_blank">
        <i class="fas fa-heartbeat"></i> Health Check
      </a>
    </nav>
    <div class="sidebar-footer">
      <div class="admin-info">
        <div class="admin-avatar" id="s-avatar">A</div>
        <div>
          <div style="font-size:.78rem;font-weight:600" id="s-name">Admin</div>
          <div class="admin-email" id="s-email">‚Äî</div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Log Out
      </button>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Topbar -->
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <button class="hamburger" onclick="openSidebar()"><i class="fas fa-bars"></i></button>
        <div class="topbar-title" id="topbar-title">Dashboard</div>
      </div>
      <div class="topbar-right">
        <div class="topbar-clock" id="clock">--:--:--</div>
        <button class="refresh-btn" onclick="loadAll()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
    </div>

    <!-- Content -->
    <div class="content">

      <!-- ‚îÄ‚îÄ DASHBOARD TAB ‚îÄ‚îÄ -->
      <div id="tab-dashboard">

        <!-- Stats -->
        <div class="stats-grid fadeup">
          <div class="stat-card">
            <div class="stat-icon si-purple"><i class="fas fa-users"></i></div>
            <div>
              <div class="stat-label">Total Users</div>
              <div class="stat-value" id="s-users">‚Äî</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon si-green"><i class="fas fa-dollar-sign"></i></div>
            <div>
              <div class="stat-label">Total Revenue</div>
              <div class="stat-value" id="s-revenue">‚Äî</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon si-blue"><i class="fas fa-network-wired"></i></div>
            <div>
              <div class="stat-label">Proxies Sold</div>
              <div class="stat-value" id="s-proxies">‚Äî</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon si-amber"><i class="fas fa-clock"></i></div>
            <div>
              <div class="stat-label">Pending Actions</div>
              <div class="stat-value" id="s-pending">‚Äî</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-grid fadeup fadeup-1">
          <a class="quick-card" href="admin.html">
            <div class="quick-icon si-purple" style="background:rgba(99,102,241,.15)"><i class="fas fa-sliders-h" style="color:#818cf8"></i></div>
            <div class="quick-label">Full Admin Panel</div>
            <div class="quick-sub">Manage everything</div>
          </a>
          <div class="quick-card" onclick="showTab('recharges')">
            <div class="quick-icon" style="background:rgba(16,185,129,.15)"><i class="fas fa-wallet" style="color:#10b981"></i></div>
            <div class="quick-label">Recharges</div>
            <div class="quick-sub">Approve payments</div>
          </div>
          <div class="quick-card" onclick="showTab('orders')">
            <div class="quick-icon" style="background:rgba(59,130,246,.15)"><i class="fas fa-box" style="color:#3b82f6"></i></div>
            <div class="quick-label">Orders</div>
            <div class="quick-sub">Deliver proxies</div>
          </div>
          <div class="quick-card" onclick="showTab('users')">
            <div class="quick-icon" style="background:rgba(245,158,11,.15)"><i class="fas fa-users" style="color:#f59e0b"></i></div>
            <div class="quick-label">Users</div>
            <div class="quick-sub">View all accounts</div>
          </div>
        </div>

        <!-- Mid row: Recent activity + System status -->
        <div class="grid2 fadeup fadeup-2">

          <!-- Recent Recharges -->
          <div class="panel">
            <div class="panel-head">
              <div class="panel-title"><i class="fas fa-wallet" style="color:#10b981;margin-right:8px"></i>Recent Recharges</div>
              <a class="view-all" onclick="showTab('recharges')" style="cursor:pointer">View all <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="panel-body" id="recent-recharges">
              <div class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</div>
            </div>
          </div>

          <!-- System Status -->
          <div class="panel">
            <div class="panel-head">
              <div class="panel-title"><i class="fas fa-server" style="color:#3b82f6;margin-right:8px"></i>System Status</div>
              <a href="/health" target="_blank" class="view-all">Health <i class="fas fa-external-link-alt"></i></a>
            </div>
            <div class="panel-body">
              <div class="sys-row">
                <span class="sys-label">API Server</span>
                <span class="sys-val"><div class="dot-live"></div> Online</span>
              </div>
              <div class="sys-row">
                <span class="sys-label">Database</span>
                <span class="sys-val" id="db-status"><div class="dot-warn"></div> Checking...</span>
              </div>
              <div class="sys-row">
                <span class="sys-label">Environment</span>
                <span class="sys-val">Production</span>
              </div>
              <div class="sys-row">
                <span class="sys-label">Server Time</span>
                <span class="sys-val" id="server-time">‚Äî</span>
              </div>
              <div class="sys-row" style="flex-direction:column;align-items:flex-start;gap:6px;">
                <div style="display:flex;justify-content:space-between;width:100%">
                  <span class="sys-label">Active Sessions</span>
                  <span style="font-size:.78rem;font-weight:700;color:#818cf8" id="sessions-count">‚Äî</span>
                </div>
                <div class="progress-bar" style="width:100%"><div class="progress-fill" id="sessions-bar" style="width:0%"></div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom row: Recent users + Recent orders -->
        <div class="grid2 fadeup fadeup-3">
          <div class="panel">
            <div class="panel-head">
              <div class="panel-title"><i class="fas fa-users" style="color:#818cf8;margin-right:8px"></i>Recent Users</div>
              <a class="view-all" onclick="showTab('users')" style="cursor:pointer">View all <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="panel-body" id="recent-users">
              <div class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-head">
              <div class="panel-title"><i class="fas fa-box" style="color:#3b82f6;margin-right:8px"></i>Recent Orders</div>
              <a class="view-all" onclick="showTab('orders')" style="cursor:pointer">View all <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="panel-body" id="recent-orders">
              <div class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</div>
            </div>
          </div>
        </div>

      </div>

      <!-- ‚îÄ‚îÄ USERS TAB ‚îÄ‚îÄ -->
      <div id="tab-users" style="display:none">
        <div class="panel fadeup">
          <div class="panel-head">
            <div class="panel-title"><i class="fas fa-users" style="color:#818cf8;margin-right:8px"></i>All Users</div>
            <div style="font-size:.78rem;color:var(--muted)" id="users-count-label">Loading...</div>
          </div>
          <div style="padding:16px 20px;border-bottom:1px solid var(--border)">
            <input type="text" id="user-search" oninput="filterUsers()" placeholder="üîç Search by email..." style="background:var(--bg2);border:1px solid var(--border);border-radius:9px;padding:9px 14px;color:var(--text);font-size:.84rem;width:100%;outline:none;font-family:'DM Sans',sans-serif">
          </div>
          <div class="table-wrap">
            <table class="tbl">
              <thead><tr>
                <th>User</th><th>Balance</th><th>Role</th><th>Verified</th><th>Joined</th>
              </tr></thead>
              <tbody id="users-body">
                <tr><td colspan="5" class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ RECHARGES TAB ‚îÄ‚îÄ -->
      <div id="tab-recharges" style="display:none">
        <div class="panel fadeup">
          <div class="panel-head">
            <div class="panel-title"><i class="fas fa-wallet" style="color:#10b981;margin-right:8px"></i>Recharge Requests</div>
            <div style="font-size:.78rem;color:var(--muted)" id="recharges-count-label">Loading...</div>
          </div>
          <div class="table-wrap">
            <table class="tbl">
              <thead><tr>
                <th>User</th><th>Amount</th><th>Method</th><th>Status</th><th>Date</th><th>Actions</th>
              </tr></thead>
              <tbody id="recharges-body">
                <tr><td colspan="6" class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ ORDERS TAB ‚îÄ‚îÄ -->
      <div id="tab-orders" style="display:none">
        <div class="panel fadeup">
          <div class="panel-head">
            <div class="panel-title"><i class="fas fa-box" style="color:#3b82f6;margin-right:8px"></i>Manual Orders</div>
            <div style="font-size:.78rem;color:var(--muted)" id="orders-count-label">Loading...</div>
          </div>
          <div class="table-wrap">
            <table class="tbl">
              <thead><tr>
                <th>User</th><th>Type</th><th>Volume</th><th>Price</th><th>Status</th><th>Date</th><th>Actions</th>
              </tr></thead>
              <tbody id="orders-body">
                <tr><td colspan="7" class="empty"><i class="fas fa-spinner fa-spin"></i>Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div><!-- /content -->
  </main>
</div><!-- /app -->

<script>
  const API = '';  // same origin
  let token = null;
  let allUsers = [], allRecharges = [], allOrders = [];
  let activeTab = 'dashboard';

  /* ‚ïê‚ïê AUTH ‚ïê‚ïê */
  async function doLogin() {
    const email = document.getElementById('l-email').value.trim();
    const pass  = document.getElementById('l-pass').value;
    const btn   = document.getElementById('l-btn');
    const err   = document.getElementById('l-err');
    err.style.display = 'none';
    if (!email || !pass) return showErr('Please fill in all fields.');
    btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
    try {
      const r = await fetch(API + '/api/auth/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({email, password:pass})
      });
      const d = await r.json();
      if (!r.ok) throw new Error(d.error || 'Login failed');
      if (!d.user?.isAdmin) throw new Error('Access denied ‚Äî admin only.');
      token = d.token;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(d.user));
      bootApp(d.user);
    } catch(e) {
      showErr(e.message);
    } finally {
      btn.disabled = false; btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
    }
  }

  function showErr(msg) {
    const err = document.getElementById('l-err');
    err.textContent = msg; err.style.display = 'block';
  }

  function logout() {
    localStorage.removeItem('token'); localStorage.removeItem('user');
    token = null;
    document.getElementById('app').style.display = 'none';
    document.getElementById('login-gate').style.display = 'flex';
  }

  function bootApp(user) {
    document.getElementById('login-gate').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    const letter = (user.email || 'A')[0].toUpperCase();
    document.getElementById('s-avatar').textContent = letter;
    document.getElementById('s-email').textContent = user.email || 'Admin';
    document.getElementById('s-name').textContent = user.isAdmin ? 'Administrator' : user.email;
    loadAll();
    startClock();
  }

  // Auto-login if token saved
  window.addEventListener('DOMContentLoaded', () => {
    const t = localStorage.getItem('token');
    const u = localStorage.getItem('user');
    if (t && u) {
      try {
        const user = JSON.parse(u);
        if (user.isAdmin) { token = t; bootApp(user); return; }
      } catch(e) {}
    }
    // Enter key on login
    document.getElementById('l-pass').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
    document.getElementById('l-email').addEventListener('keydown', e => { if(e.key==='Enter') document.getElementById('l-pass').focus(); });
  });

  /* ‚ïê‚ïê CLOCK ‚ïê‚ïê */
  function startClock() {
    setInterval(() => {
      document.getElementById('clock').textContent = new Date().toLocaleTimeString('en-US',{hour12:false});
      document.getElementById('server-time').textContent = new Date().toLocaleTimeString('en-US',{hour12:false});
    }, 1000);
  }

  /* ‚ïê‚ïê NAV ‚ïê‚ïê */
  const tabTitles = { dashboard:'Dashboard', users:'Users', recharges:'Recharge Requests', orders:'Manual Orders' };

  function showTab(name) {
    activeTab = name;
    document.querySelectorAll('[id^="tab-"]').forEach(el => el.style.display = 'none');
    document.getElementById('tab-' + name).style.display = 'block';
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    const btn = document.querySelector(`.nav-item[onclick*="${name}"]`);
    if (btn) btn.classList.add('active');
    document.getElementById('topbar-title').textContent = tabTitles[name] || name;
    closeSidebar();
  }

  function openSidebar() {
    document.getElementById('sidebar').classList.add('open');
    document.getElementById('overlay').classList.add('open');
  }
  function closeSidebar() {
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.remove('open');
  }

  /* ‚ïê‚ïê API HELPERS ‚ïê‚ïê */
  const headers = () => ({ 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' });

  async function api(url, opts={}) {
    const r = await fetch(API + url, { headers: headers(), ...opts });
    return r.json();
  }

  /* ‚ïê‚ïê LOAD ALL ‚ïê‚ïê */
  async function loadAll() {
    try { await loadStats(); } catch(e) {}
    try { await loadUsers(); } catch(e) {}
    try { await loadRecharges(); } catch(e) {}
    try { await loadOrders(); } catch(e) {}
    checkDbStatus();
  }

  /* ‚ïê‚ïê STATS ‚ïê‚ïê */
  async function loadStats() {
    const d = await api('/api/admin/stats');
    document.getElementById('s-users').textContent = d.totalUsers ?? '‚Äî';
    document.getElementById('s-revenue').textContent = d.totalRevenue != null ? '$' + Number(d.totalRevenue).toFixed(2) : '‚Äî';
    document.getElementById('s-proxies').textContent = d.totalProxies ?? '‚Äî';
    document.getElementById('db-status').innerHTML = '<div class="dot-live"></div> Connected';
  }

  /* ‚ïê‚ïê USERS ‚ïê‚ïê */
  async function loadUsers() {
    allUsers = await api('/api/admin/users');
    renderUsers(allUsers);
    document.getElementById('users-count-label').textContent = allUsers.length + ' users';
  }

  function renderUsers(list) {
    const body = document.getElementById('users-body');
    const recentBody = document.getElementById('recent-users');
    if (!list.length) { body.innerHTML = '<tr><td colspan="5" class="empty"><i class="fas fa-users"></i>No users found</td></tr>'; return; }

    body.innerHTML = list.map(u => `
      <tr>
        <td><span class="user-avatar">${(u.email||'?')[0].toUpperCase()}</span>${esc(u.email)}</td>
        <td style="font-weight:700;color:#10b981">$${(u.balance||0).toFixed(2)}</td>
        <td><span class="badge ${u.isAdmin?'badge-admin':'badge-user'}">${u.isAdmin?'Admin':'User'}</span></td>
        <td>${u.isEmailVerified ? '<span style="color:#10b981"><i class="fas fa-check-circle"></i></span>' : '<span style="color:#ef4444"><i class="fas fa-times-circle"></i></span>'}</td>
        <td style="color:var(--muted)">${fmtDate(u.createdAt)}</td>
      </tr>`).join('');

    // Recent users (last 5)
    const recent = [...list].slice(0,5);
    recentBody.innerHTML = recent.map(u => `
      <div class="activity-item">
        <div class="act-icon" style="background:rgba(99,102,241,.15);color:#818cf8;font-size:.78rem">${(u.email||'?')[0].toUpperCase()}</div>
        <div class="act-text">
          <div class="act-title">${esc(u.email)}</div>
          <div class="act-sub">$${(u.balance||0).toFixed(2)} balance ¬∑ ${u.isAdmin?'Admin':'User'}</div>
        </div>
        <div class="act-time">${fmtDate(u.createdAt)}</div>
      </div>`).join('');
  }

  function filterUsers() {
    const q = document.getElementById('user-search').value.toLowerCase();
    renderUsers(q ? allUsers.filter(u => (u.email||'').toLowerCase().includes(q)) : allUsers);
  }

  /* ‚ïê‚ïê RECHARGES ‚ïê‚ïê */
  async function loadRecharges() {
    allRecharges = await api('/api/admin/recharges');
    renderRecharges();
    const pending = allRecharges.filter(r => r.status === 'pending').length;
    const badge = document.getElementById('badge-recharges');
    badge.textContent = pending;
    badge.className = pending > 0 ? 'nav-badge' : 'nav-badge hidden';
    document.getElementById('recharges-count-label').textContent = allRecharges.length + ' requests ¬∑ ' + pending + ' pending';
    updatePendingCount();
  }

  function renderRecharges() {
    const body = document.getElementById('recharges-body');
    if (!allRecharges.length) { body.innerHTML = '<tr><td colspan="6" class="empty"><i class="fas fa-wallet"></i>No recharge requests</td></tr>'; return; }
    body.innerHTML = allRecharges.slice(0,50).map(r => {
      const rawParts = (r.faucetpayUsername || '').split(' | ');
      const method = rawParts[0] || '‚Äî';
      const isPending = r.status === 'pending';
      return `<tr>
        <td>${esc(r.userEmail || '‚Äî')}</td>
        <td style="font-weight:700;color:#10b981">$${(r.amount||0).toFixed(2)}</td>
        <td>${esc(method)}</td>
        <td><span class="badge badge-${r.status||'pending'}">${r.status||'pending'}</span></td>
        <td style="color:var(--muted)">${fmtDate(r.createdAt)}</td>
        <td>${isPending ? `
          <button onclick="approveRecharge('${r._id}')" style="padding:5px 12px;border-radius:7px;border:none;cursor:pointer;font-size:.75rem;font-weight:700;background:rgba(16,185,129,.15);color:#10b981;margin-right:4px;font-family:'DM Sans',sans-serif">‚úì Approve</button>
          <button onclick="rejectRecharge('${r._id}')" style="padding:5px 12px;border-radius:7px;border:none;cursor:pointer;font-size:.75rem;font-weight:700;background:rgba(239,68,68,.15);color:#ef4444;font-family:'DM Sans',sans-serif">‚úó Reject</button>` : '‚Äî'}
        </td>
      </tr>`;
    }).join('');

    // Recent panel
    const rBody = document.getElementById('recent-recharges');
    const recent = allRecharges.slice(0,5);
    rBody.innerHTML = recent.map(r => {
      const rawParts = (r.faucetpayUsername||'').split(' | ');
      const method = rawParts[0] || 'Payment';
      const iconMap = {binance:'üíõ', bkash:'ü©∑', nagad:'üü†', rocket:'üíú', mvola:'üì±'};
      const icon = iconMap[method.toLowerCase()] || 'üí≥';
      return `<div class="activity-item">
        <div class="act-icon" style="background:rgba(16,185,129,.1);font-size:1rem">${icon}</div>
        <div class="act-text">
          <div class="act-title">${esc(r.userEmail||'‚Äî')} ‚Äî <strong style="color:#10b981">$${(r.amount||0).toFixed(2)}</strong></div>
          <div class="act-sub">${esc(method)}</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
          <span class="badge badge-${r.status||'pending'}" style="font-size:.62rem">${r.status}</span>
          <span class="act-time">${fmtDate(r.createdAt)}</span>
        </div>
      </div>`;
    }).join('');
  }

  async function approveRecharge(id) {
    if (!confirm('Approve this recharge?')) return;
    await api('/api/admin/recharges/' + id + '/approve', {method:'POST'});
    await loadRecharges();
  }
  async function rejectRecharge(id) {
    if (!confirm('Reject this recharge?')) return;
    await api('/api/admin/recharges/' + id + '/reject', {method:'POST'});
    await loadRecharges();
  }

  /* ‚ïê‚ïê ORDERS ‚ïê‚ïê */
  async function loadOrders() {
    allOrders = await api('/api/admin/manual-orders');
    renderOrders();
    const pending = allOrders.filter(o => o.status === 'pending').length;
    const badge = document.getElementById('badge-orders');
    badge.textContent = pending;
    badge.className = pending > 0 ? 'nav-badge' : 'nav-badge hidden';
    document.getElementById('orders-count-label').textContent = allOrders.length + ' orders ¬∑ ' + pending + ' pending';
    updatePendingCount();
  }

  function renderOrders() {
    const body = document.getElementById('orders-body');
    const statusColor = { pending:'badge-pending', processing:'badge-delivered', delivered:'badge-approved', cancelled:'badge-rejected' };
    if (!allOrders.length) { body.innerHTML = '<tr><td colspan="7" class="empty"><i class="fas fa-box"></i>No orders yet</td></tr>'; return; }
    body.innerHTML = allOrders.slice(0,50).map(o => `
      <tr>
        <td>${esc(o.userEmail||'‚Äî')}</td>
        <td>${esc(o.typeLabel||o.type||'‚Äî')}</td>
        <td>${esc(o.volume||'‚Äî')}</td>
        <td style="font-weight:700;color:#818cf8">$${(o.totalPrice||0).toFixed(2)}</td>
        <td><span class="badge ${statusColor[o.status]||'badge-pending'}">${o.status||'pending'}</span></td>
        <td style="color:var(--muted)">${fmtDate(o.createdAt)}</td>
        <td>
          ${o.status==='pending'||o.status==='processing' ? `<a href="admin.html" style="font-size:.75rem;color:#818cf8;font-weight:600;text-decoration:none">Manage ‚Üí</a>` : '‚Äî'}
        </td>
      </tr>`).join('');

    // Recent orders panel
    const rBody = document.getElementById('recent-orders');
    const recent = allOrders.slice(0,5);
    const typeIcon = {datacenter:'üè¢', residential:'üçÄ', residential_pro:'üíª', mobile:'üì±', static_isp:'üèéÔ∏è'};
    rBody.innerHTML = recent.map(o => `
      <div class="activity-item">
        <div class="act-icon" style="background:rgba(59,130,246,.1);font-size:.95rem">${typeIcon[o.type]||'üì¶'}</div>
        <div class="act-text">
          <div class="act-title">${esc(o.userEmail||'‚Äî')} ‚Äî <strong style="color:#818cf8">$${(o.totalPrice||0).toFixed(2)}</strong></div>
          <div class="act-sub">${esc(o.typeLabel||o.type||'‚Äî')} ¬∑ ${esc(o.volume||'‚Äî')}</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
          <span class="badge ${statusColor[o.status]||'badge-pending'}" style="font-size:.62rem">${o.status}</span>
          <span class="act-time">${fmtDate(o.createdAt)}</span>
        </div>
      </div>`).join('');
  }

  /* ‚ïê‚ïê PENDING COUNTER ‚ïê‚ïê */
  function updatePendingCount() {
    const pr = (allRecharges||[]).filter(r=>r.status==='pending').length;
    const po = (allOrders||[]).filter(o=>o.status==='pending'||o.status==='processing').length;
    const total = pr + po;
    document.getElementById('s-pending').textContent = total;
    const sessions = Math.min(100, total * 5 + 30);
    document.getElementById('sessions-count').textContent = total + ' actions';
    document.getElementById('sessions-bar').style.width = sessions + '%';
  }

  /* ‚ïê‚ïê DB STATUS CHECK ‚ïê‚ïê */
  async function checkDbStatus() {
    try {
      const r = await fetch(API + '/health');
      const d = await r.json();
      if (d.status === 'OK') document.getElementById('db-status').innerHTML = '<div class="dot-live"></div> Connected';
    } catch(e) {
      document.getElementById('db-status').innerHTML = '<div class="dot-warn"></div> Unreachable';
    }
  }

  /* ‚ïê‚ïê UTILS ‚ïê‚ïê */
  function esc(s) {
    return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
  function fmtDate(d) {
    if (!d) return '‚Äî';
    const dt = new Date(d);
    return dt.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});
  }
</script>
</body>
</html>
